name: sky130hd_temp-sense-generator

on:
  # push:
  #   branches:
  #   - main
  # pull_request:
  workflow_dispatch:

jobs:
  tempSense-sky130hd:
    runs-on: self-hosted
    steps:

      - name: Clone this repo
        uses: actions/checkout@v2

      - name: Clone OpenFASOC repo
        run: |
          mkdir $GITHUB_WORKSPACE/openfasoc && cd $GITHUB_WORKSPACE/openfasoc
          git clone https://github.com/saicharan0112/OpenFASOC && cd OpenFASOC


      - name: Run regression
        run: |
          cp $GITHUB_WORKSPACE/utils/run_regression.sh $GITHUB_WORKSPACE/openfasoc/OpenFASOC/.
          cd $GITHUB_WORKSPACE/openfasoc/OpenFASOC/ && chmod 755 run_regression.sh
          ./run_regression.sh     


      - name: Build csv file and archive the results
        run: |

          cp $GITHUB_WORKSPACE/utils/build_csv.py /home/$USER/runner_data/.
          cp $GITHUB_WORKSPACE/utils/build_results.sh /home/$USER/runner_data/.
          cd /home/$USER/runner_data/. && ./build_results.sh

      - name: Upload the csv file to this repo
        run: |

          cd $GITHUB_WORKSPACE
          sudo rm -rf openfasoc
          git status
          git config --global user.name 'sai charan'
          git config --global user.email 'saicharan0112@users.noreply.github.com'
          git add -A 
          git commit -m "add run data"
          git push